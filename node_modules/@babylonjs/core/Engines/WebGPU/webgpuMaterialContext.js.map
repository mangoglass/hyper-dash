{"version":3,"file":"webgpuMaterialContext.js","sourceRoot":"","sources":["../../../../sourceES6/core/Engines/WebGPU/webgpuMaterialContext.ts"],"names":[],"mappings":"AAoBA,cAAc;AACd;IASI,+BAAY,cAAqC;QAC7C,IAAI,CAAC,gBAAgB,GAAG,cAAc,CAAC;QACvC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QACnB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QACnB,IAAI,CAAC,QAAQ,GAAG,qBAAqB,CAAC,QAAQ,EAAE,CAAC;IACrD,CAAC;IAEM,0CAAU,GAAjB,UAAkB,IAAY,EAAE,eAA0C;QACtE,IAAM,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QACzC,IAAI,CAAC,YAAY,EAAE;YACf,OAAO,KAAK,CAAC;SAChB;QAED,IAAM,UAAU,GAAG,YAAY,CAAC,OAAO,CAAC;QACxC,IAAI,UAAU,KAAK,IAAI,IAAI,UAAU,KAAK,eAAe;YACrD,CAAC,YAAY,CAAC,KAAK,KAAK,eAAe,CAAC,YAAY,IAAI,YAAY,CAAC,KAAK,KAAK,eAAe,CAAC,YAAY,IAAI,YAAY,CAAC,KAAK,KAAK,eAAe,CAAC,YAAY;gBAC9J,YAAY,CAAC,yBAAyB,KAAK,eAAe,CAAC,gCAAgC,IAAI,YAAY,CAAC,YAAY,KAAK,eAAe,CAAC,YAAY,CAAC,EAClK;YACI,0HAA0H;YAC1H,6EAA6E;YAC7E,YAAY,CAAC,KAAK,GAAG,eAAe,CAAC,YAAY,CAAC;YAClD,YAAY,CAAC,KAAK,GAAG,eAAe,CAAC,YAAY,CAAC;YAClD,YAAY,CAAC,KAAK,GAAG,eAAe,CAAC,YAAY,CAAC;YAClD,YAAY,CAAC,yBAAyB,GAAG,eAAe,CAAC,gCAAgC,CAAC;YAC1F,YAAY,CAAC,YAAY,GAAG,eAAe,CAAC,YAAY,CAAC;YACzD,IAAI,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;SAClE;QAED,YAAY,CAAC,OAAO,GAAG,eAAgB,CAAC;QAExC,OAAO,IAAI,CAAC;IAChB,CAAC;IAvCc,8BAAQ,GAAG,CAAC,CAAC;IAwChC,4BAAC;CAAA,AAzCD,IAyCC;SAzCY,qBAAqB","sourcesContent":["import { InternalTexture } from \"../../Materials/Textures/internalTexture\";\r\nimport { Nullable } from \"../../types\";\r\nimport { IMaterialContext } from \"../IMaterialContext\";\r\nimport { WebGPUCacheBindGroups } from \"./webgpuCacheBindGroups\";\r\n\r\n/** @hidden */\r\ninterface IWebGPUMaterialContextSamplerCache {\r\n    firstTextureName: string;\r\n}\r\n\r\n/** @hidden */\r\ninterface IWebGPUMaterialContextTextureCache {\r\n    texture: InternalTexture;\r\n    wrapU?: Nullable<number>;\r\n    wrapV?: Nullable<number>;\r\n    wrapR?: Nullable<number>;\r\n    anisotropicFilteringLevel?: Nullable<number>;\r\n    samplingMode?: Nullable<number>;\r\n}\r\n\r\n/** @hidden */\r\nexport class WebGPUMaterialContext implements IMaterialContext {\r\n    private static _Counter = 0;\r\n\r\n    public uniqueId: number;\r\n    public samplers: { [name: string]: Nullable<IWebGPUMaterialContextSamplerCache> };\r\n    public textures: { [name: string]: Nullable<IWebGPUMaterialContextTextureCache> };\r\n\r\n    private _cacheBindGroups: WebGPUCacheBindGroups;\r\n\r\n    constructor(cachBindGroups: WebGPUCacheBindGroups) {\r\n        this._cacheBindGroups = cachBindGroups;\r\n        this.samplers = {};\r\n        this.textures = {};\r\n        this.uniqueId = WebGPUMaterialContext._Counter++;\r\n    }\r\n\r\n    public setTexture(name: string, internalTexture: Nullable<InternalTexture>): boolean {\r\n        const textureCache = this.textures[name];\r\n        if (!textureCache) {\r\n            return false;\r\n        }\r\n\r\n        const curTexture = textureCache.texture;\r\n        if (curTexture !== null && curTexture === internalTexture &&\r\n            (textureCache.wrapU !== internalTexture._cachedWrapU || textureCache.wrapV !== internalTexture._cachedWrapV || textureCache.wrapR !== internalTexture._cachedWrapR ||\r\n                textureCache.anisotropicFilteringLevel !== internalTexture._cachedAnisotropicFilteringLevel || textureCache.samplingMode !== internalTexture.samplingMode))\r\n        {\r\n            // the sampler used to sample the texture must be updated, so we need to clear the bind group cache entries that are using\r\n            // this texture so that the bind groups are re-created with the right sampler\r\n            textureCache.wrapU = internalTexture._cachedWrapU;\r\n            textureCache.wrapV = internalTexture._cachedWrapV;\r\n            textureCache.wrapR = internalTexture._cachedWrapR;\r\n            textureCache.anisotropicFilteringLevel = internalTexture._cachedAnisotropicFilteringLevel;\r\n            textureCache.samplingMode = internalTexture.samplingMode;\r\n            this._cacheBindGroups.clearTextureEntries(curTexture.uniqueId);\r\n        }\r\n\r\n        textureCache.texture = internalTexture!;\r\n\r\n        return true;\r\n    }\r\n}\r\n"]}